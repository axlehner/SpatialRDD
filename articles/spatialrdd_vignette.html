<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpatialRDD: get started • SpatialRDD</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SpatialRDD: get started">
<meta property="og:description" content="SpatialRDD">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpatialRDD</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shifting_borders.html">Shifting Borders, Creating Polygons from Lines</a>
    </li>
    <li>
      <a href="../articles/spatialrdd_vignette.html">SpatialRDD: get started</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/axlehner/SpatialRDD/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SpatialRDD: get started</h1>
                        <h4 data-toc-skip class="author">Alexander
Lehner</h4>
            
            <h4 data-toc-skip class="date">2024-01-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/axlehner/SpatialRDD/blob/HEAD/vignettes/spatialrdd_vignette.Rmd" class="external-link"><code>vignettes/spatialrdd_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>spatialrdd_vignette.Rmd</code></div>

    </div>

    
    
<p>In recent years, spatial versions of Regression Discontinuity Designs
(RDDs) have increased tremendously in popularity in the social sciences.
In practice, executing spatial RDDs, especially the many required
robustness- and sensitivity checks, is quite cumbersome. It requires
knowledge of statistical programming and handling and working with
geographic objects (points, lines, polygons). Practitioners typically
carry out these GIS tasks in a “point and click” fashion in GUIs like
ArcGIS, QGIS, or GeoDA and then manually export these data into the
statistical environment of their choice. Statistical analysis is then
carry out in an a-spatial way. This is sub-optimal for several
reasons:</p>
<ul>
<li>it is very time consuming and cumbersome</li>
<li>it is prone to errors</li>
<li>it is not reproducible</li>
<li>it is not very flexible and makes it harder to understand the data
at hand</li>
</ul>
<p><code>SpatialRDD</code> is the first (geo-)statistical package that
unifies the geographic tasks needed for spatial RDDs with all potential
parametric and non-parametric estimation techniques that have been put
forward <span class="citation">(see e.g. <strong>Lehner2023a?</strong>
for an overview)</span>. It makes it easy to understand critical
assumptions regarding bandwidths, sparse border points, and border
segment fixed effects. Furthermore, the flexibility of the
<code>shift_border</code> function makes it attractive for all sorts of
identification strategies outside of the RD literature that rely on
shifting placebo borders.</p>
<p>Geographic objects are treated as <a href="https://en.wikipedia.org/wiki/Simple_Features" class="external-link">simple features</a>
throughout, making heavy use of the <code>sf</code> package by Edzer
Pebesma which revolutionized spatial data analysis in <strong>R</strong>
and has already superseded the older and less versatile <code>sp</code>
package.<br><code>SpatialRDD</code> facilitates analysis inter alia because it
contains all necessary functions to automatize otherwise very tedious
tasks that are typically carried out “by hand” in the GUIs of GIS
software. <code>SpatialRDD</code> unifies everything in one language and
e.g. has the necessary functions to check and visualize the implications
of different bandwidths, shift placebo boundaries, do all necessary
distance calculations, assign treated/non-treated indicators, and
flexibly assign border segment fixed effects while keeping the units of
observations at their proper position in space and allowing the
researcher to visualize every intermediate step with map plots. For the
latter we will mostly rely on the flexible and computationally very
efficient <code>tmap</code> package, while also <code>ggplot2</code> is
used at times.<br>
For the purpose of illustration, this vignette uses simulated data on
real boundaries/polygons and guides the user through every necessary
step in order to carry out a spatial RDD estimation. At the appropriate
points, we will also make remarks on technical caveats and issues that
have been pointed out in the literature and give suggestions to improve
these designs.<br>
The workhorse functions of <code>SpatialRDD</code> in a nutshell
are:</p>
<ul>
<li><code><a href="../reference/assign_treated.html">assign_treated()</a></code></li>
<li><code><a href="../reference/border_segment.html">border_segment()</a></code></li>
<li><code><a href="../reference/discretise_border.html">discretise_border()</a></code></li>
<li><code><a href="../reference/SpatialRD.html">spatialrd()</a></code></li>
<li><code><a href="../reference/plotspatialrd.html">plotspatialrd()</a></code></li>
<li><code><a href="../reference/printspatialrd.html">printspatialrd()</a></code></li>
<li><code><a href="../reference/shift_border.html">shift_border()</a></code></li>
<li><code><a href="../reference/cutoff2polygon.html">cutoff2polygon()</a></code></li>
</ul>
<p>and they are going to be introduced here in precisely this order.</p>
<div class="section level3">
<h3 id="some-words-of-caution">Some words of caution<a class="anchor" aria-label="anchor" href="#some-words-of-caution"></a>
</h3>
<p>You (obviously) have to pay attention that you have an RD border that
is fine-grained enough so that it resembles the true cutoff. Something
at the degree of e.g. the widely used GADM boundaries (just as an
example, because administrative boundaries themselves are usually never
valid RD cutoffs due to the compound treatment problem) is most probably
not detailed enough. Furthermore it is suggested to always work in a
localized projection system that has meters as units - as opposed to
e.g. degrees (you can check that with <code>st_crs(data)$units</code>).
A good choice would be UTM: find the right grid <a href="http://www.dmap.co.uk/utmworld.htm" class="external-link">here</a>, then get the
corresponding <a href="https://epsg.io" class="external-link">EPSG number</a> and use it in
<code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform()</a></code> after you imported your data <span class="citation">(see e.g. Bivand and Pebesma 2023 for guidance on
projection systems)</span>.</p>
</div>
<div class="section level2">
<h2 id="setup-and-propaedeutics">Setup and Propaedeutics<a class="anchor" aria-label="anchor" href="#setup-and-propaedeutics"></a>
</h2>
<p>Throughout the vignette we will use the geographic boundaries on Goa,
India, from <span class="citation">Lehner (2023)</span>. The data,
included in the package, contains</p>
<ol style="list-style-type: decimal">
<li>a line called <code>cut_off</code> which describes the spatial
discontinuity</li>
<li>a polygon that defines the “treated” area</li>
<li>a polygon that defines the full study area (which is going to be
useful as this defines the bounding box)</li>
</ol>
<p>For your own RD design you need 1. in the form of either a line (as a
single feature, i.e. all potential segments merged together) or a finely
spaced set of points on your border. Furthermore you need the polygon
that specifies the treatment area, and, of course, the data set that
contains all your observations, including the x- and y-coordinate for
each unit of observation. This way it is easy to convert the data to an
sf data.frame.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://axlehner.github.io/SpatialRDD/" class="external-link">SpatialRDD</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># more intuitive data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stargazer</span><span class="op">)</span> <span class="co"># easy way to make model output look more appealing (R-inline, html, or latex)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<p>The data shown here come in EPSG:32643, which is a “localized” <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system" class="external-link">UTM</a>
coordinate reference system (CRS). These are generally preferable for
exercises like a Spatial RDD, as they are more precise and also allow us
to work in meters (the “classic” longitude/latitude CRS, EPSG 4326,
works in degrees). If your study area is small, you should reproject
your data into the CRS of the according UTM zone (simply use
<code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform()</a></code>). To verify the units of our CRS we could
simply run <code>st_crs(cut_off)$units</code>.</p>
<p>All the spatial objects are of class <code>sf</code> from the <a href="https://CRAN.R-project.org/package=sf" class="external-link">sf package</a>. This means
they are just a <code>data.frame</code> with a special column that
contains a geometry for each row. The big advantage is, no matter if you
prefer base R, <code>dplyr</code>, or any other way to handle and
wrangle your data, the <code>sf</code> object can be treated just like a
standard <code>data.frame</code>. The one single step that transforms
these spatial objects back to a standard <code>data.frame</code> is just
dropping the geometry column with</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">any.sf.object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>or alternatively</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="va">any.sf.object</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>If you import geospatial data in a different format, say the common
shapefile (<code>*.shp</code>) - which is NOT preferrable <a href="http://switchfromshapefile.org/" class="external-link">see here why</a>, or as a
geopackage (<code>*.gpkg</code>), it is fairly straightforward to
convert it:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata.sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"path/to/file.shp"</span><span class="op">)</span></span></code></pre></div>
<p>In case your data is saved as a <code>*.csv</code> (if in Stata file
format, check the <code>foreign</code> and <code>readstata13</code>
package) you just have to tell <code>sf</code> in which columns the x-
and x-coordinates are saved, and it will convert it into a spatial
object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata.sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">loaded_file</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="va">projcrs</span><span class="op">)</span> </span>
<span><span class="co"># just the EPSG as an integer or a proj4string of the desired CRS</span></span></code></pre></div>
<p>For more thorough information, I suggest consulting the documentation
and vignettes of the <code>sf</code> package or <span class="citation">Bivand and Pebesma (2023)</span>.</p>
<div class="section level3">
<h3 id="inspecting-the-study-area-simulating-data">Inspecting the Study Area &amp; simulating Data<a class="anchor" aria-label="anchor" href="#inspecting-the-study-area-simulating-data"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cut_off</span>, <span class="va">polygon_full</span>, <span class="va">polygon_treated</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Breaking News: tmap 3.x is retiring. Please test v4, e.g. with</span></span>
<span><span class="co">#&gt; remotes::install_github('r-tmap/tmap')</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">polygon_full</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">polygon_treated</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Above we see the simple map, visualizing the “treated polygon” in a
darker grey, and the <code>tmap</code> syntax that produced it.</p>
<p>Let’s simulate some random points within the polygon that describes
the entire study area:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1088</span><span class="op">)</span> <span class="co"># set a seed to make the results replicable</span></span>
<span><span class="va">points_samp.sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">polygon_full</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">points_samp.sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="co"># make it an sf object bc st_sample only created the geometry list-column (sfc)</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="co"># add a unique ID to each observation</span></span>
<span><span class="co"># visualise results together with the line that represents our RDD cutoff</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="assign-treatment">Assign Treatment<a class="anchor" aria-label="anchor" href="#assign-treatment"></a>
</h3>
<p>Now we use the first function of the <code>SpatialRDD</code> package.
<code><a href="../reference/assign_treated.html">assign_treated()</a></code> in essence just does a spatial
intersection and returns a column vector that contains <code>0</code> or
<code>1</code>, depending on whether the observation is inside or
outside the treatment area. Thus, we just add it as a new column to the
points object. The function requires the name of the points object, the
name of the polygon that defines the treated area, and the id that
uniquely identifies each observation in the points object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_treated.html">assign_treated</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">polygon_treated</span>, id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"treated"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>As a next step we add an outcome of interest that we are going to use
as dependent variable in our Spatial Regression Discontinuity Design.
Let’s call this variable <code>education</code> and assume it measures
the literacy rate that ranges from 0 to 1 (0%, meaning everyone is
illiterate, to 100%, meaning everyone in the population can read and
write). We assume that the units, call them villages, in the “treated”
polygon have on average a higher literacy rate because they received
some sort of “treatment”. Let’s just assume aliens dropped (better)
schools in all of these villages, but not in any of the outside
villages, and everything else is constant and identical across the two
territories. Crucially, people also do not sort themselves across the
border, i.e. they do not go on the other side to attend school and then
return to their villages.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first we define a variable for the number of "treated" and control which makes the code more readable in the future</span></span>
<span><span class="va">NTr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">NCo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># the treated areas get a 10 percentage point higher literacy rate</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.6</span></span>
<span><span class="co"># and we add some noise, otherwise we would obtain regression coeffictions with no standard errors</span></span>
<span><span class="co"># we draw from a normal with mean 0 and a standard devation of 0.1</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">NTr</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">NCo</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># let's also add a placebo outcome that has no jump</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">placebo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualisation split up by groups</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">education</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">treated</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>From the above histograms we can see that we were successful in
creating different group means. This is also confirmed by the simple
univariate regression of <span class="math inline">\(y_i = \alpha +
\beta\ \unicode{x1D7D9}(treated)_i + \varepsilon_i\)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">treated</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">)</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">placebo</span>   <span class="op">~</span> <span class="va">treated</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stargazer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html" class="external-link">stargazer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ===========================================================</span></span>
<span><span class="co">#&gt;                                    Dependent variable:     </span></span>
<span><span class="co">#&gt;                                ----------------------------</span></span>
<span><span class="co">#&gt;                                   education      placebo   </span></span>
<span><span class="co">#&gt;                                      (1)           (2)     </span></span>
<span><span class="co">#&gt; -----------------------------------------------------------</span></span>
<span><span class="co">#&gt; treated1                          0.100***        0.035*   </span></span>
<span><span class="co">#&gt;                                    (0.008)       (0.020)   </span></span>
<span><span class="co">#&gt;                                                            </span></span>
<span><span class="co">#&gt; Constant                          0.600***       0.990***  </span></span>
<span><span class="co">#&gt;                                    (0.004)       (0.009)   </span></span>
<span><span class="co">#&gt;                                                            </span></span>
<span><span class="co">#&gt; -----------------------------------------------------------</span></span>
<span><span class="co">#&gt; Observations                        1,000         1,000    </span></span>
<span><span class="co">#&gt; R2                                  0.160         0.003    </span></span>
<span><span class="co">#&gt; Adjusted R2                         0.160         0.002    </span></span>
<span><span class="co">#&gt; Residual Std. Error (df = 998)      0.100         0.260    </span></span>
<span><span class="co">#&gt; F Statistic (df = 1; 998)        186.000***       3.100*   </span></span>
<span><span class="co">#&gt; ===========================================================</span></span>
<span><span class="co">#&gt; Note:                           *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</span></span></code></pre></div>
<p>where the intercept tells us that the average in the non-treated
areas is 0.6 and treated villages have on average a 10 percentage points
higher education level.</p>
<div class="section level4">
<h4 id="distance-to-cutoff">Distance to Cutoff<a class="anchor" aria-label="anchor" href="#distance-to-cutoff"></a>
</h4>
<p>The next essential step before we start t do proper Spatial RDD
analysis is to determine how far each of these points is away from the
cutoff. Here we just make use of a function from <code>sf</code> called
<code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_distance()</a></code> that returns a vector with units (that we
have to convert to real numbers by <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric()</a></code>):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_distance</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">cut_off</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This allows us now to investigate villages only within a specific
range, say 3 kilometers, around our “discontinuity”:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"education"</span>, palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>And to run the univariate regression from above also just within a
bandwidth (this specification is already starting to resemble the
canonical parametric spatial RD specification). As we know the exact
data generating process (no “spatial gradient” but a rather uniform
assignment), it is obvious to us that this of course leaves the point
estimate essentially unchanged:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">treated</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stargazer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html" class="external-link">stargazer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ===============================================</span></span>
<span><span class="co">#&gt;                         Dependent variable:    </span></span>
<span><span class="co">#&gt;                     ---------------------------</span></span>
<span><span class="co">#&gt;                              education         </span></span>
<span><span class="co">#&gt; -----------------------------------------------</span></span>
<span><span class="co">#&gt; treated1                     0.090***          </span></span>
<span><span class="co">#&gt;                               (0.015)          </span></span>
<span><span class="co">#&gt;                                                </span></span>
<span><span class="co">#&gt; Constant                     0.610***          </span></span>
<span><span class="co">#&gt;                               (0.011)          </span></span>
<span><span class="co">#&gt;                                                </span></span>
<span><span class="co">#&gt; -----------------------------------------------</span></span>
<span><span class="co">#&gt; Observations                    159            </span></span>
<span><span class="co">#&gt; R2                             0.190           </span></span>
<span><span class="co">#&gt; Adjusted R2                    0.180           </span></span>
<span><span class="co">#&gt; Residual Std. Error      0.095 (df = 157)      </span></span>
<span><span class="co">#&gt; F Statistic           36.000*** (df = 1; 157)  </span></span>
<span><span class="co">#&gt; ===============================================</span></span>
<span><span class="co">#&gt; Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="carrying-out-spatial-rdd-estimation">Carrying out Spatial RDD estimation<a class="anchor" aria-label="anchor" href="#carrying-out-spatial-rdd-estimation"></a>
</h2>
<p>Now we go step by step through all potential (parametric and
non-parametric) ways in which one could obtain point estimates for
Spatial RDDs <span class="citation">(see e.g.
<strong>Lehner2023a?</strong> for details)</span>.</p>
<div class="section level3">
<h3 id="naive-distance">Naive Distance<a class="anchor" aria-label="anchor" href="#naive-distance"></a>
</h3>
<p>For the “naive” estimation <span class="citation">(Keele and Titiunik
2015)</span>, meaning that the spatial dimension is essentially
disregarded, we first define a variable <code>distrunning</code> that
makes the distances in the treated areas negative so that our
2-dimensional cutoff is then at 0.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">distrunning</span> <span class="op">&lt;-</span> <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span></span>
<span><span class="co"># give the non-treated one's a negative score</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">distrunning</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">distrunning</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">points_samp.sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">distrunning</span>, y <span class="op">=</span> <span class="va">education</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The point estimate of the “classic” non-parametric local linear
regression, carried out with the <code>rdrobust</code> package <span class="citation">(Calonico, Cattaneo, and Titiunik 2015)</span>, then
looks like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rdrobust</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rdrobust/man/rdrobust.html" class="external-link">rdrobust</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span>, <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">distrunning</span>, c <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sharp RD estimates using local polynomial regression.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Obs.                 1000</span></span>
<span><span class="co">#&gt; BW type                       mserd</span></span>
<span><span class="co">#&gt; Kernel                   Triangular</span></span>
<span><span class="co">#&gt; VCE method                       NN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Obs.                  785          215</span></span>
<span><span class="co">#&gt; Eff. Number of Obs.             127          100</span></span>
<span><span class="co">#&gt; Order est. (p)                    1            1</span></span>
<span><span class="co">#&gt; Order bias  (q)                   2            2</span></span>
<span><span class="co">#&gt; BW est. (h)                4248.546     4248.546</span></span>
<span><span class="co">#&gt; BW bias (b)                6601.220     6601.220</span></span>
<span><span class="co">#&gt; rho (h/b)                     0.644        0.644</span></span>
<span><span class="co">#&gt; Unique Obs.                     785          215</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; =============================================================================</span></span>
<span><span class="co">#&gt;         Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       </span></span>
<span><span class="co">#&gt; =============================================================================</span></span>
<span><span class="co">#&gt;   Conventional     0.116     0.025     4.580     0.000     [0.066 , 0.166]     </span></span>
<span><span class="co">#&gt;         Robust         -         -     4.089     0.000     [0.064 , 0.181]     </span></span>
<span><span class="co">#&gt; =============================================================================</span></span></code></pre></div>
<p>and the according visualization with data driven bin-width
selection:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rdrobust/man/rdplot.html" class="external-link">rdplot</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">education</span>, <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">distrunning</span>, c <span class="op">=</span> <span class="fl">0</span>, ci <span class="op">=</span> <span class="fl">95</span>, </span>
<span>       kernel <span class="op">=</span> <span class="st">"triangular"</span>, y.label <span class="op">=</span> <span class="st">"education"</span>, x.label <span class="op">=</span> <span class="st">"distance to border"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-16-1.png" width="\textwidth"></p>
<p>For RDD estimation in <strong>R</strong>, in general, there are
currently three packages flying around: <code>RDD</code>,
<code>rddtools</code>, and <code>rddapp</code> (building on the
<code>RDD</code>); whereby the latter seems to be the most up-to-date
and comprehensive one (as it draws on previous work that others
did).<br><code>rddapp</code> estimates various specifications (does not do robust
inference, though)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rddapp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">rd_est</span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">distrunning</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span>, t.design <span class="op">=</span> <span class="st">"g"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And it gives several possibilities of visualizing classic,
one-dimensional RDDs. Here we arbitrarily pick one parametric and one
non-parametric estimate, including confidence intervals, and manually
chosen binsizes:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">rd_est</span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">distrunning</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span>, t.design <span class="op">=</span> <span class="st">"g"</span><span class="op">)</span>, fit_line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quadratic"</span>, <span class="st">"optimal"</span><span class="op">)</span>, bin_n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parametric-specifications">Parametric Specifications<a class="anchor" aria-label="anchor" href="#parametric-specifications"></a>
</h3>
<p>This method, popularized by <span class="citation">Dell (2010)</span>
in her influential on the Peruvian Mining Mita, examines only
observations within a certain distance around the border by using a
parametric approach. From the point of view of which additional “spatial
technicalities” are needed, it essentially only boils down to the
introduction of border segments. These are then used to apply a “within
estimator” to allow for different intercepts for each of those segment
categories in order to, inter alia, alleviate the omitted variable
problem. As is well known, instead of a within transformation, one might
as well throw a set of dummies for each of the segments in the
regression. The regression coefficient of interest of this saturated
model then gives a weighted average over all segments. On top of that we
might also be interested in the coefficient of each segment to infer
something about potential heterogeneity alongside our regression
discontinuity.<br>
The (computationally a bit demanding) function
<code><a href="../reference/border_segment.html">border_segment()</a></code> only needs the points layer and the cutoff
as input (preferably as a line, but also an input in the form of points
at the boundary works). The function’s last parameter lets us determine
how many segments we want. As with the <code><a href="../reference/assign_treated.html">assign_treated()</a></code>
function, the output is a vector of factors.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">segment10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/border_segment.html">border_segment</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">cut_off</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">segment15</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/border_segment.html">border_segment</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">cut_off</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"segment10"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"segment15"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-19-1.png" width="700"><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-19-2.png" width="700"></p>
<p>It is worth noting that the researcher has to pay attention to how
the fixed effects are assigned. It could, e.g. due to odd bendings of
the cutoff, be the case that for some segments only one side actually
gets assigned a point. These situations are undesirable for two main
reasons. First, estimation with segments that contain either only
treated or only untreated units will be dropped automatically. Second,
fixed effects category with a small amount of observations are not very
informative for estimation. It is thus paramount to always plot the
fixed effect categories on a map. The <code><a href="../reference/border_segment.html">border_segment()</a></code>
already gives the researcher a feeling for how meaningful the choice for
the number of segments was. In the above example we have a segment for
every 13 kilometers, which seems not too unreasonable. We could already
see however, that some of the categories contain very little
observations. In the following example, we thus choose fewer border
points, leading to more observations on each side of the border for
every segment and thus to more meaningful point estimates:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">segment5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/border_segment.html">border_segment</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">cut_off</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"segment5"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Simple OLS estimates, using the segments that we just obtained as
categories for our fixed effects, show these differences:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MatthieuStigler/lfe" class="external-link">lfe</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">lfe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">treated</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">segment15</span><span class="op">)</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="fl">0</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span><span class="fu">lfe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">treated</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">segment5</span><span class="op">)</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="fl">0</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stargazer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html" class="external-link">stargazer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; =====================================================</span></span>
<span><span class="co">#&gt;                            Dependent variable:       </span></span>
<span><span class="co">#&gt;                     ---------------------------------</span></span>
<span><span class="co">#&gt;                                 education            </span></span>
<span><span class="co">#&gt;                           (1)              (2)       </span></span>
<span><span class="co">#&gt; -----------------------------------------------------</span></span>
<span><span class="co">#&gt; treated1                0.094***         0.089***    </span></span>
<span><span class="co">#&gt;                         (0.016)          (0.015)     </span></span>
<span><span class="co">#&gt;                                                      </span></span>
<span><span class="co">#&gt; -----------------------------------------------------</span></span>
<span><span class="co">#&gt; Observations              159              159       </span></span>
<span><span class="co">#&gt; R2                       0.280            0.250      </span></span>
<span><span class="co">#&gt; Adjusted R2              0.200            0.220      </span></span>
<span><span class="co">#&gt; Residual Std. Error 0.094 (df = 143) 0.092 (df = 153)</span></span>
<span><span class="co">#&gt; =====================================================</span></span>
<span><span class="co">#&gt; Note:                     *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</span></span></code></pre></div>
<p>The confidence intervals of both point estimates are overlapping,
yet, one can see that the fixed effects choice can have a substantial
impact. We obtain a point estimate that is (unsurprisingly, as we have a
data generating process that is very uniform across space) very similar
to the one we obtained from the simple OLS regression from the
beginning. As compared to the “classic RD” point estimate that we
obtained from the non-parametric local linear regression from the
<code>rdrobust</code> package, the point estimate from our fixed effects
regression is a bit more conservative. But from eyeballing we can
determine that the average effect lies somewhere around 0.1, meaning
that the literacy rate is 10 percentage points higher in the treated
areas. Exactly the way we designed our simulated data.</p>
</div>
<div class="section level3">
<h3 id="grd">GRD<a class="anchor" aria-label="anchor" href="#grd"></a>
</h3>
<p>Finally we move towards a fully fledged Geographic Regression
Discontinuity (GRD) design <span class="citation">(according to the
nomenclature by Keele and Titiunik 2015)</span>. The function
<code><a href="../reference/SpatialRD.html">spatialrd()</a></code> incorporates the RD estimation with two running
variables but also allows to carry out the estimation on any boundary
point (“GRDDseries”) with just one line of code. This allows us to
visualize the treatment effect at multiple points of the cutoff and thus
infer something about the potential heterogeneity of the effect. Or,
most importantly, to assess the robustness of the GRD itself.</p>
<p>First of all we have to cut the border into equally spaced segments.
We will obtain a point estimate for each of these segments, or boundary
points. The <code><a href="../reference/discretise_border.html">discretise_border()</a></code> function just requires the
sf object that represent the cutoff (polyline preferred but also points
possible) and the number of desired boundary points:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">borderpoints.sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discretise_border.html">discretise_border</a></span><span class="op">(</span>cutoff <span class="op">=</span> <span class="va">cut_off</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">borderpoints.sf</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">borderpoints.sf</span><span class="op">)</span></span>
<span><span class="co"># exclude some of the borderpoints with little n so that the vignette can compile without warning:</span></span>
<span><span class="co">#borderpoints.sf &lt;- borderpoints.sf %&gt;% slice(c(5,10,20,30,40))</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"education"</span>, palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, size <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">cut_off</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">borderpoints.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_symbols</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">4</span>, size <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>For plotting just a results table, it would be preferrable to choose
just a <code>data.frame</code> as output
(<code>spatial.object = FALSE</code>).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialRD.html">spatialrd</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"education"</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span>, cutoff.points <span class="op">=</span> <span class="va">borderpoints.sf</span>, treated <span class="op">=</span> <span class="st">"treated"</span>, minobs <span class="op">=</span> <span class="fl">10</span>, spatial.object <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="9%">
<col width="8%">
<col width="7%">
<col width="7%">
<col width="6%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="10%">
<col width="10%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">Point</th>
<th align="right">Estimate</th>
<th align="right">SE_Conv</th>
<th align="right">SE_Rob</th>
<th align="right">p_Conv</th>
<th align="right">p_Rob</th>
<th align="right">Ntr</th>
<th align="right">Nco</th>
<th align="right">bw_l</th>
<th align="right">bw_r</th>
<th align="right">CI_Conv_l</th>
<th align="right">CI_Conv_u</th>
<th align="right">CI_Rob_l</th>
<th align="right">CI_Rob_u</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.12</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">0.05</td>
<td align="right">53</td>
<td align="right">55</td>
<td align="right">14.2</td>
<td align="right">14.2</td>
<td align="right">0.02</td>
<td align="right">0.21</td>
<td align="right">0.00</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.14</td>
<td align="right">0.07</td>
<td align="right">0.08</td>
<td align="right">0.04</td>
<td align="right">0.07</td>
<td align="right">71</td>
<td align="right">57</td>
<td align="right">15.2</td>
<td align="right">15.2</td>
<td align="right">0.00</td>
<td align="right">0.27</td>
<td align="right">-0.01</td>
<td align="right">0.30</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.11</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">0.06</td>
<td align="right">103</td>
<td align="right">84</td>
<td align="right">19.9</td>
<td align="right">19.9</td>
<td align="right">0.02</td>
<td align="right">0.21</td>
<td align="right">0.00</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.08</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.11</td>
<td align="right">0.22</td>
<td align="right">100</td>
<td align="right">65</td>
<td align="right">16.0</td>
<td align="right">16.0</td>
<td align="right">-0.02</td>
<td align="right">0.17</td>
<td align="right">-0.05</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.08</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.11</td>
<td align="right">0.22</td>
<td align="right">104</td>
<td align="right">73</td>
<td align="right">17.3</td>
<td align="right">17.3</td>
<td align="right">-0.02</td>
<td align="right">0.17</td>
<td align="right">-0.04</td>
<td align="right">0.19</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.07</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.09</td>
<td align="right">0.22</td>
<td align="right">112</td>
<td align="right">84</td>
<td align="right">20.9</td>
<td align="right">20.9</td>
<td align="right">-0.01</td>
<td align="right">0.15</td>
<td align="right">-0.04</td>
<td align="right">0.16</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.06</td>
<td align="right">0.03</td>
<td align="right">0.04</td>
<td align="right">0.08</td>
<td align="right">0.20</td>
<td align="right">108</td>
<td align="right">62</td>
<td align="right">18.9</td>
<td align="right">18.9</td>
<td align="right">-0.01</td>
<td align="right">0.13</td>
<td align="right">-0.03</td>
<td align="right">0.13</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.07</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.10</td>
<td align="right">0.18</td>
<td align="right">93</td>
<td align="right">46</td>
<td align="right">17.1</td>
<td align="right">17.1</td>
<td align="right">-0.01</td>
<td align="right">0.15</td>
<td align="right">-0.03</td>
<td align="right">0.16</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.11</td>
<td align="right">0.07</td>
<td align="right">0.08</td>
<td align="right">0.09</td>
<td align="right">0.11</td>
<td align="right">77</td>
<td align="right">33</td>
<td align="right">14.1</td>
<td align="right">14.1</td>
<td align="right">-0.02</td>
<td align="right">0.24</td>
<td align="right">-0.03</td>
<td align="right">0.27</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.13</td>
<td align="right">0.07</td>
<td align="right">0.08</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">69</td>
<td align="right">32</td>
<td align="right">12.3</td>
<td align="right">12.3</td>
<td align="right">0.01</td>
<td align="right">0.26</td>
<td align="right">0.00</td>
<td align="right">0.30</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">0.18</td>
<td align="right">0.07</td>
<td align="right">0.08</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">56</td>
<td align="right">32</td>
<td align="right">11.1</td>
<td align="right">11.1</td>
<td align="right">0.04</td>
<td align="right">0.32</td>
<td align="right">0.03</td>
<td align="right">0.35</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">0.25</td>
<td align="right">0.12</td>
<td align="right">0.13</td>
<td align="right">0.03</td>
<td align="right">0.03</td>
<td align="right">40</td>
<td align="right">22</td>
<td align="right">9.6</td>
<td align="right">9.6</td>
<td align="right">0.02</td>
<td align="right">0.48</td>
<td align="right">0.02</td>
<td align="right">0.53</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">0.32</td>
<td align="right">0.14</td>
<td align="right">0.15</td>
<td align="right">0.02</td>
<td align="right">0.02</td>
<td align="right">29</td>
<td align="right">17</td>
<td align="right">8.2</td>
<td align="right">8.2</td>
<td align="right">0.04</td>
<td align="right">0.60</td>
<td align="right">0.05</td>
<td align="right">0.65</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">0.20</td>
<td align="right">0.07</td>
<td align="right">0.08</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">33</td>
<td align="right">32</td>
<td align="right">9.5</td>
<td align="right">9.5</td>
<td align="right">0.06</td>
<td align="right">0.35</td>
<td align="right">0.06</td>
<td align="right">0.40</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">0.15</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">24</td>
<td align="right">30</td>
<td align="right">8.8</td>
<td align="right">8.8</td>
<td align="right">0.03</td>
<td align="right">0.27</td>
<td align="right">0.04</td>
<td align="right">0.32</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">0.16</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">52</td>
<td align="right">86</td>
<td align="right">13.7</td>
<td align="right">13.7</td>
<td align="right">0.06</td>
<td align="right">0.25</td>
<td align="right">0.06</td>
<td align="right">0.28</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="right">0.18</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">30</td>
<td align="right">45</td>
<td align="right">10.7</td>
<td align="right">10.7</td>
<td align="right">0.07</td>
<td align="right">0.29</td>
<td align="right">0.07</td>
<td align="right">0.33</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">0.15</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">56</td>
<td align="right">98</td>
<td align="right">14.5</td>
<td align="right">14.5</td>
<td align="right">0.04</td>
<td align="right">0.26</td>
<td align="right">0.02</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">0.11</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">0.09</td>
<td align="right">96</td>
<td align="right">102</td>
<td align="right">16.4</td>
<td align="right">16.4</td>
<td align="right">0.01</td>
<td align="right">0.20</td>
<td align="right">-0.01</td>
<td align="right">0.21</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.08</td>
<td align="right">0.16</td>
<td align="right">85</td>
<td align="right">56</td>
<td align="right">13.9</td>
<td align="right">13.9</td>
<td align="right">-0.01</td>
<td align="right">0.21</td>
<td align="right">-0.04</td>
<td align="right">0.23</td>
</tr>
<tr class="odd">
<td align="right">21</td>
<td align="right">0.08</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.11</td>
<td align="right">0.22</td>
<td align="right">80</td>
<td align="right">39</td>
<td align="right">13.2</td>
<td align="right">13.2</td>
<td align="right">-0.02</td>
<td align="right">0.19</td>
<td align="right">-0.05</td>
<td align="right">0.20</td>
</tr>
<tr class="even">
<td align="right">22</td>
<td align="right">0.07</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.21</td>
<td align="right">0.35</td>
<td align="right">73</td>
<td align="right">53</td>
<td align="right">13.3</td>
<td align="right">13.3</td>
<td align="right">-0.04</td>
<td align="right">0.19</td>
<td align="right">-0.07</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="right">23</td>
<td align="right">0.10</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.04</td>
<td align="right">0.12</td>
<td align="right">96</td>
<td align="right">52</td>
<td align="right">14.1</td>
<td align="right">14.1</td>
<td align="right">0.00</td>
<td align="right">0.20</td>
<td align="right">-0.02</td>
<td align="right">0.21</td>
</tr>
<tr class="even">
<td align="right">24</td>
<td align="right">0.10</td>
<td align="right">0.05</td>
<td align="right">0.07</td>
<td align="right">0.05</td>
<td align="right">0.14</td>
<td align="right">103</td>
<td align="right">60</td>
<td align="right">14.5</td>
<td align="right">14.5</td>
<td align="right">0.00</td>
<td align="right">0.21</td>
<td align="right">-0.03</td>
<td align="right">0.23</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.10</td>
<td align="right">0.23</td>
<td align="right">83</td>
<td align="right">57</td>
<td align="right">13.6</td>
<td align="right">13.6</td>
<td align="right">-0.02</td>
<td align="right">0.22</td>
<td align="right">-0.06</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="right">26</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.09</td>
<td align="right">0.43</td>
<td align="right">0.64</td>
<td align="right">55</td>
<td align="right">49</td>
<td align="right">11.7</td>
<td align="right">11.7</td>
<td align="right">-0.09</td>
<td align="right">0.20</td>
<td align="right">-0.13</td>
<td align="right">0.22</td>
</tr>
<tr class="odd">
<td align="right">27</td>
<td align="right">0.05</td>
<td align="right">0.08</td>
<td align="right">0.10</td>
<td align="right">0.56</td>
<td align="right">0.80</td>
<td align="right">37</td>
<td align="right">38</td>
<td align="right">9.6</td>
<td align="right">9.6</td>
<td align="right">-0.11</td>
<td align="right">0.21</td>
<td align="right">-0.17</td>
<td align="right">0.22</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">0.01</td>
<td align="right">0.09</td>
<td align="right">0.11</td>
<td align="right">0.88</td>
<td align="right">0.95</td>
<td align="right">32</td>
<td align="right">34</td>
<td align="right">9.2</td>
<td align="right">9.2</td>
<td align="right">-0.17</td>
<td align="right">0.19</td>
<td align="right">-0.22</td>
<td align="right">0.21</td>
</tr>
<tr class="odd">
<td align="right">31</td>
<td align="right">0.08</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.20</td>
<td align="right">0.35</td>
<td align="right">65</td>
<td align="right">61</td>
<td align="right">12.8</td>
<td align="right">12.8</td>
<td align="right">-0.04</td>
<td align="right">0.19</td>
<td align="right">-0.08</td>
<td align="right">0.21</td>
</tr>
<tr class="even">
<td align="right">32</td>
<td align="right">0.11</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.07</td>
<td align="right">0.14</td>
<td align="right">47</td>
<td align="right">39</td>
<td align="right">10.6</td>
<td align="right">10.6</td>
<td align="right">-0.01</td>
<td align="right">0.22</td>
<td align="right">-0.03</td>
<td align="right">0.24</td>
</tr>
<tr class="odd">
<td align="right">33</td>
<td align="right">0.10</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.04</td>
<td align="right">102</td>
<td align="right">68</td>
<td align="right">14.9</td>
<td align="right">14.9</td>
<td align="right">0.02</td>
<td align="right">0.17</td>
<td align="right">0.00</td>
<td align="right">0.20</td>
</tr>
<tr class="even">
<td align="right">34</td>
<td align="right">0.10</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">109</td>
<td align="right">63</td>
<td align="right">14.8</td>
<td align="right">14.8</td>
<td align="right">0.03</td>
<td align="right">0.18</td>
<td align="right">0.02</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="right">35</td>
<td align="right">0.11</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">53</td>
<td align="right">47</td>
<td align="right">11.3</td>
<td align="right">11.3</td>
<td align="right">0.02</td>
<td align="right">0.19</td>
<td align="right">0.02</td>
<td align="right">0.22</td>
</tr>
<tr class="even">
<td align="right">36</td>
<td align="right">0.17</td>
<td align="right">0.03</td>
<td align="right">0.03</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">24</td>
<td align="right">25</td>
<td align="right">8.6</td>
<td align="right">8.6</td>
<td align="right">0.11</td>
<td align="right">0.23</td>
<td align="right">0.12</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="right">37</td>
<td align="right">0.15</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">38</td>
<td align="right">21</td>
<td align="right">8.6</td>
<td align="right">8.6</td>
<td align="right">0.05</td>
<td align="right">0.26</td>
<td align="right">0.05</td>
<td align="right">0.29</td>
</tr>
<tr class="even">
<td align="right">38</td>
<td align="right">0.15</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">108</td>
<td align="right">44</td>
<td align="right">13.4</td>
<td align="right">13.4</td>
<td align="right">0.04</td>
<td align="right">0.25</td>
<td align="right">0.02</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="right">39</td>
<td align="right">0.13</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">167</td>
<td align="right">64</td>
<td align="right">16.5</td>
<td align="right">16.5</td>
<td align="right">0.03</td>
<td align="right">0.22</td>
<td align="right">0.03</td>
<td align="right">0.26</td>
</tr>
<tr class="even">
<td align="right">40</td>
<td align="right">0.14</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">137</td>
<td align="right">62</td>
<td align="right">15.1</td>
<td align="right">15.1</td>
<td align="right">0.04</td>
<td align="right">0.24</td>
<td align="right">0.04</td>
<td align="right">0.28</td>
</tr>
<tr class="odd">
<td align="right">41</td>
<td align="right">0.18</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">61</td>
<td align="right">45</td>
<td align="right">11.1</td>
<td align="right">11.1</td>
<td align="right">0.06</td>
<td align="right">0.30</td>
<td align="right">0.07</td>
<td align="right">0.34</td>
</tr>
<tr class="even">
<td align="right">42</td>
<td align="right">0.15</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">57</td>
<td align="right">50</td>
<td align="right">10.9</td>
<td align="right">10.9</td>
<td align="right">0.03</td>
<td align="right">0.26</td>
<td align="right">0.04</td>
<td align="right">0.30</td>
</tr>
<tr class="odd">
<td align="right">43</td>
<td align="right">0.13</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">152</td>
<td align="right">64</td>
<td align="right">15.5</td>
<td align="right">15.5</td>
<td align="right">0.04</td>
<td align="right">0.22</td>
<td align="right">0.04</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="right">44</td>
<td align="right">0.11</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">99</td>
<td align="right">60</td>
<td align="right">13.3</td>
<td align="right">13.3</td>
<td align="right">0.01</td>
<td align="right">0.22</td>
<td align="right">0.00</td>
<td align="right">0.26</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="right">0.10</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">111</td>
<td align="right">59</td>
<td align="right">13.8</td>
<td align="right">13.8</td>
<td align="right">0.01</td>
<td align="right">0.20</td>
<td align="right">0.00</td>
<td align="right">0.23</td>
</tr>
<tr class="even">
<td align="right">46</td>
<td align="right">0.11</td>
<td align="right">0.06</td>
<td align="right">0.08</td>
<td align="right">0.09</td>
<td align="right">0.10</td>
<td align="right">112</td>
<td align="right">52</td>
<td align="right">13.4</td>
<td align="right">13.4</td>
<td align="right">-0.02</td>
<td align="right">0.23</td>
<td align="right">-0.02</td>
<td align="right">0.28</td>
</tr>
<tr class="odd">
<td align="right">47</td>
<td align="right">0.08</td>
<td align="right">0.05</td>
<td align="right">0.06</td>
<td align="right">0.12</td>
<td align="right">0.13</td>
<td align="right">130</td>
<td align="right">60</td>
<td align="right">15.5</td>
<td align="right">15.5</td>
<td align="right">-0.02</td>
<td align="right">0.18</td>
<td align="right">-0.03</td>
<td align="right">0.21</td>
</tr>
<tr class="even">
<td align="right">48</td>
<td align="right">0.06</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.12</td>
<td align="right">0.18</td>
<td align="right">233</td>
<td align="right">75</td>
<td align="right">23.0</td>
<td align="right">23.0</td>
<td align="right">-0.02</td>
<td align="right">0.15</td>
<td align="right">-0.03</td>
<td align="right">0.18</td>
</tr>
<tr class="odd">
<td align="right">49</td>
<td align="right">0.06</td>
<td align="right">0.04</td>
<td align="right">0.06</td>
<td align="right">0.17</td>
<td align="right">0.23</td>
<td align="right">162</td>
<td align="right">67</td>
<td align="right">19.6</td>
<td align="right">19.6</td>
<td align="right">-0.03</td>
<td align="right">0.15</td>
<td align="right">-0.04</td>
<td align="right">0.17</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">0.05</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.24</td>
<td align="right">0.35</td>
<td align="right">112</td>
<td align="right">60</td>
<td align="right">17.6</td>
<td align="right">17.6</td>
<td align="right">-0.03</td>
<td align="right">0.12</td>
<td align="right">-0.05</td>
<td align="right">0.14</td>
</tr>
</tbody>
</table>
<p>The average treatment effect is given by taking the mean of all point
estimates. Running <code>mean(results$Estimate)</code> this gives 0.12,
which is exactly how we designed our DGP. For the plotting of the
<em>GRDDseries</em> and a visualisation in space of each point estimate
we need to have a spatial object. All this is incorporated in the
<code><a href="../reference/plotspatialrd.html">plotspatialrd()</a></code> function.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialRD.html">spatialrd</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"education"</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span>, cutoff.points <span class="op">=</span> <span class="va">borderpoints.sf</span>, treated <span class="op">=</span> <span class="st">"treated"</span>, minobs <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotspatialrd.html">plotspatialrd</a></span><span class="op">(</span><span class="va">results</span>, map <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<p>Or just the <em>GRDDseries</em> without the map.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotspatialrd.html">plotspatialrd</a></span><span class="op">(</span><span class="va">results</span>, map <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="robustness">Robustness<a class="anchor" aria-label="anchor" href="#robustness"></a>
</h2>
<p>In Spatial Regression Discontinuity exercises, the researcher usually
also has to show that the results are robust towards different
specifications and parameters. Also in this respect the
<code>SpatialRDD</code> package offers a lot of capabilities that are
time saving and make replicability easy. This toolbox for shifting and
moving around borders and afterwards assigning (placebo) treatment
status again is in fact so potent, that it is of use in many other
research design settings outside of geographic RDs. In this vignette we
will just see the basic intuition. For more details on all the options
check out the separate vignette <code>shifting_borders</code> or go to
the <a href="https://axlehner.github.io/SpatialRDD/articles/shifting_borders.html" class="external-link">copy
of the article on the package website</a>.</p>
<div class="section level3">
<h3 id="placebo-borders">Placebo Borders<a class="anchor" aria-label="anchor" href="#placebo-borders"></a>
</h3>
<p>Here we are going to apply a standard tool that we got to know in
linear algebra 1 classes: an affine transformation of the type <span class="math inline">\(f(x) = x\mathbf{A}+b\)</span>, where the matrix
<span class="math inline">\(\mathbf{A}\)</span> is the projection matrix
to shift, (re-)scale, or rotate the border. For simplicity we now only
apply a shift by 3000 meters in both the x- and y-coordinates of the
border.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">placebocut_off.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/shift_border.html">shift_border</a></span><span class="op">(</span><span class="va">cut_off</span>, operation <span class="op">=</span> <span class="st">"shift"</span>, shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">placeboborderpoints.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discretise_border.html">discretise_border</a></span><span class="op">(</span>cutoff <span class="op">=</span> <span class="va">placebocut_off.1</span>, n <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"treated"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">placeboborderpoints.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_symbols</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">4</span>, size <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">placebocut_off.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>After the border shift we now have to re-assign the new treatment
status in order to carry out regressions. For that matter, we create new
polygons from scratch with the <code>cutoff2polygons()</code> function.
The logic of this function is not very intuitive at first, but the
vignette on border shifting will clarify that. In our case, we do not
have to go around corners with the counterfactual polygon because both
ends of the cutoff go towards the West. Just make sure that the
endpoints are chosen in a way so that all observations that should be in
the “placebo treated” group are also actually inside this resulting
polygon.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">placebo.poly.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cutoff2polygon.html">cutoff2polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">points_samp.sf</span>, cutoff <span class="op">=</span> <span class="va">placebocut_off.1</span>, orientation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"west"</span>, <span class="st">"west"</span><span class="op">)</span>, endpoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">placebo.poly.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>Finally, we have to use the <code><a href="../reference/assign_treated.html">assign_treated()</a></code> function
from the beginning of the vignette again:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_treated.html">assign_treated</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">points_samp.sf</span>, polygon <span class="op">=</span> <span class="va">placebo.poly.1</span>, id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">points_samp.sf</span><span class="op">$</span><span class="va">treated1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># number of villages that switched treatment status</span></span>
<span><span class="co">#&gt; [1] 60</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">points_samp.sf</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span><span class="st">"treated1"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">placeboborderpoints.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_symbols</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">4</span>, size <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">placebocut_off.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>After plotting the points again, we can visually infer that the
villages to the right got assigned the “treated” dummy. Further we can
compute the number of villages that change their status. This helps us
to decide whether the bordershift was big enough (if e.g. only a handful
of observations switched, then we would expect this to have little to no
impact on our point estimates and thus would dub such a robustness
exercise as not very meaningful).<br>
In this case 60 villages changed. Given the initial number of treated
observations, this seems a change of a big enough magnitude and thus a
meaningful robustness exercise.</p>
<div class="section level4">
<h4 id="robustness-grd">Robustness GRD<a class="anchor" aria-label="anchor" href="#robustness-grd"></a>
</h4>
<p>Finally, we do the exact same exercise from above again and run the
nonparametric specification on many boundary points to approximate a
continuous treatment effect. The series fluctuates around 0 and has not
a single significant estimate, and it is thus safe to conclude that the
methodology works.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SpatialRD.html">spatialrd</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"education"</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span>, cutoff.points <span class="op">=</span> <span class="va">placeboborderpoints.1</span>, treated <span class="op">=</span> <span class="st">"treated1"</span>, minobs <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotspatialrd.html">plotspatialrd</a></span><span class="op">(</span><span class="va">results1</span>, map <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatialrdd_vignette_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="robustness-polynomial-specification">Robustness Polynomial Specification<a class="anchor" aria-label="anchor" href="#robustness-polynomial-specification"></a>
</h4>
<p>Before we close, let’s also run our placebo exercise with the
parametric specification. Unfortunately, OLS with fixed effects is not
as sensitive when it comes to detecting the border shift. The
coefficient is still borderline significant. In this case, we should
have moved the border 1 or 2 kilometers farther to make it
insignificant.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">segment.1.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/border_segment.html">border_segment</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">placebocut_off.1</span>, <span class="fl">5</span><span class="op">)</span> <span class="co"># assigning new segments based on now cutoff</span></span>
<span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_distance</a></span><span class="op">(</span><span class="va">points_samp.sf</span>, <span class="va">placebocut_off.1</span><span class="op">)</span><span class="op">)</span> <span class="co"># recompute distance to new placebo cutoff</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">treated1</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff1</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu">lfe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">education</span> <span class="op">~</span> <span class="va">treated1</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">segment.1.5</span><span class="op">)</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="fl">0</span>, data <span class="op">=</span> <span class="va">points_samp.sf</span><span class="op">[</span><span class="va">points_samp.sf</span><span class="op">$</span><span class="va">dist2cutoff1</span> <span class="op">&lt;</span> <span class="fl">3000</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stargazer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html" class="external-link">stargazer</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt;                             Dependent variable:         </span></span>
<span><span class="co">#&gt;                     ------------------------------------</span></span>
<span><span class="co">#&gt;                                  education              </span></span>
<span><span class="co">#&gt;                             OLS               felm      </span></span>
<span><span class="co">#&gt;                             (1)               (2)       </span></span>
<span><span class="co">#&gt; --------------------------------------------------------</span></span>
<span><span class="co">#&gt; treated11                  0.021             0.018      </span></span>
<span><span class="co">#&gt;                           (0.015)           (0.015)     </span></span>
<span><span class="co">#&gt;                                                         </span></span>
<span><span class="co">#&gt; Constant                 0.620***                       </span></span>
<span><span class="co">#&gt;                           (0.010)                       </span></span>
<span><span class="co">#&gt;                                                         </span></span>
<span><span class="co">#&gt; --------------------------------------------------------</span></span>
<span><span class="co">#&gt; Observations                177               177       </span></span>
<span><span class="co">#&gt; R2                         0.011             0.032      </span></span>
<span><span class="co">#&gt; Adjusted R2                0.005             0.004      </span></span>
<span><span class="co">#&gt; Residual Std. Error  0.100 (df = 175)   0.100 (df = 171)</span></span>
<span><span class="co">#&gt; F Statistic         1.900 (df = 1; 175)                 </span></span>
<span><span class="co">#&gt; ========================================================</span></span>
<span><span class="co">#&gt; Note:                        *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bivand_Pebesma_2023" class="csl-entry">
Bivand, Roger, and Edzer Pebesma. 2023. <em>Spatial Data Science: With
Applications in r</em>. New York: Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9780429459016" class="external-link">https://doi.org/10.1201/9780429459016</a>.
</div>
<div id="ref-Calonico_Cattaneo_Titiunik_2015" class="csl-entry">
Calonico, Sebastian, Matias D. Cattaneo, and Rocío Titiunik. 2015.
<span>“Rdrobust: An r Package for Robust Nonparametric Inference in
Regression-Discontinuity Designs.”</span> <em>R Journal</em> 7 (1):
38–51.
</div>
<div id="ref-Dell_2010" class="csl-entry">
Dell, Melissa. 2010. <span>“The Persistent Effects of Peru’s Mining
Mita.”</span> <em>Econometrica</em> 78 (6): 1863–903.
</div>
<div id="ref-Keele_Titiunik_2015" class="csl-entry">
Keele, Luke J., and Rocío Titiunik. 2015. <span>“Geographic Boundaries
as Regression Discontinuities.”</span> <em>Political Analysis</em> 23
(1): 127–55. <a href="https://doi.org/10.1093/pan/mpu014" class="external-link">https://doi.org/10.1093/pan/mpu014</a>.
</div>
<div id="ref-Lehner_2023" class="csl-entry">
Lehner, Alexander. 2023. <span>“Culture, Institutions, and the Roots of
Gender Inequality: 450 Years of Portuguese Colonialism in India.”</span>
<em>Mimeograph</em>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Lehner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
